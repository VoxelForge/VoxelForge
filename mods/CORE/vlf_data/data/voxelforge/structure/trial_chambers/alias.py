# Alias list
alias = {
    "minecraft:air": "air",
    "minecraft:barrel": "voxelforge:barrel_closed",
    "minecraft:bed": "voxelforge:blue_bed",
    "minecraft:black_bed": "voxelforge:bed_black_bottom",
    "minecraft:black_stained_glass": "voxelforge:glass_black",
    "minecraft:blue_bed": "voxelforge:bed_blue_bottom",
    "minecraft:bone_block": "voxelforge:bone_block",
    "minecraft:brown_bed": "voxelforge:bed_brown_bottom",
    "minecraft:cactus": "voxelforge:cactus",
    "minecraft:candle": "voxelforge:candle_lit_1",
    "minecraft:chain": "voxelforge:chain",
    "minecraft:chest": "voxelforge:chest_small",
    "minecraft:chiseled_sandstone": "voxelforge:sandstonecarved",
    "minecraft:chiseled_tuff": "voxelforge:tuff_chiseled",
    "minecraft:chiseled_tuff_bricks": "voxelforge:tuff_chiseled_bricks",
    "minecraft:cobbled_deepslate": "voxelforge:deepslate_cobbled",
    "minecraft:cobblestone": "voxelforge:cobble",
    "minecraft:cobweb": "voxelforge:cobweb",
    "minecraft:copper_block": "voxelforge:copper",
    "minecraft:crafting_table": "voxelforge:crafting_table",
    "minecraft:cyan_bed": "voxelforge:bed_cyan_bottom",
    "minecraft:dead_bush": "voxelforge:deadbush",
    "minecraft:decorated_pot": "voxelforge:pot",
    "minecraft:dirt": "voxelforge:dirt",
    "minecraft:dispenser": "voxelforge:dispenser",
    "minecraft:flower_pot": "voxelforge:flower_pot",
    "minecraft:gray_bed": "voxelforge:bed_gray_bottom",
    "minecraft:green_bed": "voxelforge:bed_green_bottom",
    "minecraft:hopper": "voxelforge:hopper",
    "minecraft:jigsaw": "voxelforge:jigsaw",
    "minecraft:ladder": "voxelforge:ladder",
    "minecraft:light_blue_bed": "voxelforge:bed_light_blue_bottom",
    "minecraft:light_gray_bed": "voxelforge:bed_silver_bottom",
    "minecraft:light_gray_stained_glass": "voxelforge:glass_silver",
    "minecraft:lime_bed": "voxelforge:bed_lime_bottom",
    "minecraft:magenta_bed": "voxelforge:bed_magenta_bottom",
    "minecraft:magma_block": "voxelforge:magma",
    "minecraft:mangrove_leaves": "voxelforge:leaves_mangrove",
    "minecraft:mangrove_log": "voxelforge:bark_mangrove",
    "minecraft:mangrove_roots": "voxelforge:mangrove_roots",
    "minecraft:mangrove_wood": "voxelforge:wood_mangrove",
    "minecraft:moss_block": "voxelforge:moss",
    "minecraft:moss_carpet": "voxelforge:moss_carpet",
    "minecraft:mossy_cobblestone": "voxelforge:mossycobble",
    "minecraft:mud": "voxelforge:mud",
    "minecraft:oak_button": "voxelforge:button_oak_off",
    "minecraft:oak_fence": "voxelforge:oak_fence",
    "minecraft:oak_leaves": "voxelforge:leaves_oak",
    "minecraft:oak_log": "voxelforge:bark_oak",
    "minecraft:oak_pressure_plate": "voxelforge:pressure_plate_oak_off",
    "minecraft:oak_slab": "voxelforge:slab_oak",
    "minecraft:orange_bed": "voxelforge:bed_orange_bottom",
    "minecraft:oxidized_copper_trapdoor": "voxelforge:oxidized_trapdoor",
    "minecraft:oxidized_cut_copper": "voxelforge:oxidized_cut_copper",
    "minecraft:packed_ice": "voxelforge:packed_ice",
    "minecraft:pink_bed": "voxelforge:bed_pink_bottom",
    "minecraft:podzol": "voxelforge:podzol",
    "minecraft:polished_andesite": "voxelforge:andesite_smooth",
    "minecraft:polished_tuff": "voxelforge:tuff_polished",
    "minecraft:polished_tuff_slab": "voxelforge:slab_tuff_polished",
    "minecraft:potted_dead_bush": "voxelforge:flower_pot_deadbush",
    "minecraft:powder_snow": "voxelforge:powdered_snow",
    "minecraft:purple_bed": "voxelforge:bed_purple_bottom",
    "minecraft:red_bed": "voxelforge:bed_purple_bottom",
    "minecraft:red_candle": "voxelforge:candle_lit_4",
    "minecraft:red_concrete": "voxelforge:concrete_red",
    "minecraft:red_glazed_terracotta": "voxelforge:glazed_terracotta_red",
    "minecraft:red_mushroom": "voxelforge:mushroom_red",
    "minecraft:redstone_wire": "voxelforge:wire_00000000_off",
    "minecraft:sand": "voxelforge:sand",
    "minecraft:stone": "voxelforge:stone",
    "minecraft:stone_bricks": "voxelforge:stonebrick",
    "minecraft:stone_button": "voxelforge:button_stone_off",
    "minecraft:tripwire": "voxelforge:tripwire",
    "minecraft:tripwire_hook": "voxelforge:tripwire_hook",
    "minecraft:tuff_bricks": "voxelforge:tuff_bricks",
    "minecraft:vault": "voxelforge:vault",
    "minecraft:vine": "voxelforge:vine",
    "minecraft:water": "voxelforge:water_source",
    "minecraft:waxed_chiseled_copper": "voxelforge:waxed_chiseled_copper",
    "minecraft:waxed_copper_block": "voxelforge:waxed_copper",
    "minecraft:waxed_copper_bulb": "voxelforge:waxed_copper_bulb_lit",
    "minecraft:waxed_copper_door": "voxelforge:waxed_copper_door_b_1",
    "minecraft:waxed_copper_grate": "voxelforge:waxed_copper_grate",
    "minecraft:waxed_cut_copper": "voxelforge:waxed_cut_copper",
    "minecraft:waxed_cut_copper_slab": "voxelforge:slab_waxed_copper_cut",
    "minecraft:waxed_cut_copper_stairs": "voxelforge:stair_waxed_copper_cut",
    "minecraft:waxed_oxidized_chiseled_copper": "voxelforge:waxed_oxidized_chiseled_copper",
    "minecraft:waxed_oxidized_copper": "voxelforge:waxed_oxidized_copper",
    "minecraft:waxed_oxidized_copper_door": "voxelforge:waxed_oxidized_copper_door_b_1",
    "minecraft:waxed_oxidized_copper_grate": "voxelforge:waxed_oxidized_copper_grate",
    "minecraft:waxed_oxidized_copper_trapdoor": "voxelforge:waxed_oxidized_trapdoor",
    "minecraft:waxed_oxidized_cut_copper": "voxelforge:waxed_oxidized_cut_copper",
    "minecraft:waxed_oxidized_cut_copper_slab": "voxelforge:slab_waxed_copper_oxidized_cut",
    "minecraft:waxed_oxidized_cut_copper_stairs": "voxelforge:stair_waxed_copper_oxidized_cut",
    "minecraft:white_bed": "voxelforge:bed_white_bottom",
    "minecraft:white_concrete": "voxelforge:concrete_white",
    "minecraft:white_stained_glass": "voxelforge:glass_white",
    "minecraft:yellow_bed": "voxelforge:bed_yellow_bottom",
}


"""
import os
import re

def load_vlfschem(filepath):
    try:
        with open(filepath, 'r') as file:
            content = file.read()
            return content
    except Exception as e:
        print(f"Error loading .vlfschem file: {e}")
        return None

def replace_node_names_in_vlfschem(content, alias):
    def replace_match(match):
        node_name = match.group(1)
        return f'name = "{alias.get(node_name, node_name)}"'

    # Use regex to find all node names in the form of name = "minecraft:block_name"
    modified_content = re.sub(r'name\s*=\s*"([^"]+)"', replace_match, content)
    return modified_content

def save_vlfschem(filepath, content):
    try:
        with open(filepath, 'w') as file:
            file.write(content)
        print(f"Saved modified .vlfschem file: {filepath}")
    except Exception as e:
        print(f"Error saving .vlfschem file: {e}")

def process_directory(directory, alias):
    for root, dirs, files in os.walk(directory):
        for file in files:
            if file.endswith('.lua'):  # Assuming .vlfschem files have a .lua extension
                filepath = os.path.join(root, file)
                print(f"Loading schematic from file: {filepath}")
                original_content = load_vlfschem(filepath)
                if original_content:
                    modified_content = replace_node_names_in_vlfschem(original_content, alias)
                    save_vlfschem(filepath, modified_content)
                else:
                    print(f"Skipping file due to load error: {filepath}")

def replace_node_names_in_vlfschem_files(directory, alias):
    process_directory(directory, alias)

# Example usage
modpath = "/home/joshua/snap/minetest/current/games/voxelforge/mods/CORE/vlf_data"
replace_node_names_in_vlfschem_files(
    os.path.join(modpath, "data", "voxelforge", "structure", "trial_chambers"),
    alias
)
"""

"""
import os
import re

def load_vlfschem(filepath):
    "Load a Lua file (.vlfschem) as a string"
    try:
        with open(filepath, 'r') as file:
            content = file.read()
            return content
    except Exception as e:
        print(f"Error loading .vlfschem file: {e}")
        return None

def replace_node_names_in_vlfschem(content, alias):
    "Replace node names in the .vlfschem content string using the alias dictionary"
    def replace_match(match):
        node_name = match.group(1)
        new_name = alias.get(node_name, node_name)
        print(f"Replacing {node_name} with {new_name}")
        return f'name = "{new_name}"'

    # Use regex to find all node names in the form of name = "minecraft:block_name"
    modified_content = re.sub(r'name\s*=\s*"([^"]+)"', replace_match, content)
    return modified_content

def save_vlfschem(filepath, content):
    "Save the modified Lua file back to disk"
    try:
        with open(filepath, 'w') as file:
            file.write(content)
        print(f"Saved modified .vlfschem file: {filepath}")
    except Exception as e:
        print(f"Error saving .vlfschem file: {e}")

def process_directory(directory, alias):
    "Process all .vlfschem files in a directory, replacing node names"
    for root, dirs, files in os.walk(directory):
        for file in files:
            if file.endswith('.lua'):  # Assuming .vlfschem files have a .lua extension
                filepath = os.path.join(root, file)
                print(f"Loading schematic from file: {filepath}")
                original_content = load_vlfschem(filepath)
                if original_content:
                    modified_content = replace_node_names_in_vlfschem(original_content, alias)
                    if modified_content != original_content:
                        print(f"Changes detected in {filepath}, saving...")
                        save_vlfschem(filepath, modified_content)
                    else:
                        print(f"No changes made to {filepath}")
                else:
                    print(f"Skipping file due to load error: {filepath}")

def replace_node_names_in_vlfschem_files(directory, alias):
    "Main function to replace node names in all .vlfschem files in a directory"
    process_directory(directory, alias)

# Example usage
modpath = "/home/joshua/snap/minetest/current/games/voxelforge/mods/CORE/vlf_data"
replace_node_names_in_vlfschem_files(
    os.path.join(modpath, "data", "voxelforge", "structure", "trial_chambers"),
    alias
)
"""

import os
import re

def load_vlfschem(filepath):
    """Load a Lua file (.vlfschem) as a string"""
    try:
        with open(filepath, 'r') as file:
            content = file.read()
            return content
    except Exception as e:
        print(f"Error loading .vlfschem file: {e}")
        return None

def replace_node_names_in_vlfschem(content, alias):
    """Replace node names in the .vlfschem content string using the alias dictionary"""
    def replace_match(match):
        node_name = match.group(1)
        # Debugging to ensure correct replacements
        if node_name in alias:
            print(f"Replacing '{node_name}' with '{alias[node_name]}'")
        else:
            print(f"No alias for '{node_name}', keeping original")
        new_name = alias.get(node_name, node_name)
        return f'name = "{new_name}"'

    # Use regex to find all node names in the form of name = "minecraft:block_name"
    modified_content = re.sub(r'name\s*=\s*"([^"]+)"', replace_match, content)
    return modified_content

def save_vlfschem(filepath, content):
    """Save the modified Lua file back to disk"""
    try:
        with open(filepath, 'w') as file:
            file.write(content)
        print(f"Saved modified .vlfschem file: {filepath}")
    except Exception as e:
        print(f"Error saving .vlfschem file: {e}")

def process_directory(directory, alias):
    """Process all .vlfschem files in a directory, replacing node names"""
    for root, dirs, files in os.walk(directory):
        for file in files:
            if file.endswith('.lua'):  # Assuming .vlfschem files have a .lua extension
                filepath = os.path.join(root, file)
                print(f"\nProcessing file: {filepath}")
                original_content = load_vlfschem(filepath)
                
                if original_content:
                    # Debugging the original content
                    print("\nOriginal Content:")
                    print(original_content)

                    modified_content = replace_node_names_in_vlfschem(original_content, alias)

                    # Debugging the modified content
                    print("\nModified Content:")
                    print(modified_content)

                    if modified_content != original_content:
                        print(f"\nChanges detected in {filepath}, saving...")
                        save_vlfschem(filepath, modified_content)
                    else:
                        print(f"\nNo changes made to {filepath}")
                else:
                    print(f"\nSkipping file due to load error: {filepath}")

def replace_node_names_in_vlfschem_files(directory, alias):
    """Main function to replace node names in all .vlfschem files in a directory"""
    process_directory(directory, alias)

# Example usage
modpath = "/home/joshua/snap/minetest/current/games/voxelforge/mods/CORE/vlf_data"
replace_node_names_in_vlfschem_files(
    os.path.join(modpath, "data", "voxelforge", "structure", "trial_chambers"),
    alias
)